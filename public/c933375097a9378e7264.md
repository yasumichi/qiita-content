---
title: SeaPig で <webview> 内のページ遷移を抑制している方法について
tags:
  - webView
  - Electron
private: false
updated_at: '2016-08-16T00:34:13+09:00'
id: c933375097a9378e7264
organization_url_name: null
slide: false
ignorePublish: false
---
![](https://raw.githubusercontent.com/yasumichi/seapig/master/seapig.png) [SeaPig](https://github.com/yasumichi/seapig) is converter from markdown to html with marked.js and highlight.js.

SeaPig バージョン 0.4.0 以前のバージョンでは、HTMLプリビューペイン(&lt;webview&gt;)内のリンクをクリックしてしまうとリンク先にページ遷移してしまい、以降、プリビュー機能が動作しない不具合がありました。この記事では、SeaPig で <webview> 内のページ遷移を抑制している方法について説明します。

## 筆者の環境

- [VineSeed](https://vinelinux.org/vineseed.html) ([Vine Linux](https://vinelinux.org/) 開発版) 64bit
- [nodebrew](https://github.com/hokaccha/nodebrew) use v4.4.7(LTS)

## 解決策

当初、[Electron の <webview> 内でリンクを開いたときに外部ブラウザで開く - Qiita](http://qiita.com/Linda_pp/items/219847322dda3973557b)の方法で修正しましたが、'did-start-loading' の発生時に外部ブラウザに渡される URL がページ遷移前の URL になってしまい、うまく行きませんでした。

> なお、当該記事中、最近の Electron 環境では以下の修正が必要でした。
> 
> - `const shell = require('shell');` :arrow_right: `const shell = require('electron').shell;`
> - `const url = webview.getUrl();` :arrow_right: `const url = webview.getURL();`

結局、あまりスマートではないですが、以下の方法で解決しました。

- プリビュー表示用に利用している元々の HTML に &lt;base&gt; タグを属性なしで埋め込んでおく。
- プリビュー表示などのタイミングで &lt;base&gt; タグ に属性 `target="_blank"` を設定する。(`element.setAttribute(name, value)`)
 - HTML としてエクスポートする際は、当該属性を削除してからエクスポートし、元に戻す。(`element.removeAttribute(name)`)
- 先ほどの記事の 'new-window' のイベントハンドラのみ追加する。

```js
const shell = require('electron').shell;
const webview = document.getElementById('previewer');

webview.addEventListener('new-window', function(event) {
  webview.stop();
  shell.openExternal(event.url);
});
```

`<base target="_blank">` となっていることにより、原則、すべてのリンクが別ウィンドウで開かれるはずであり、'new-window' イベントのみ捕捉すればよくなるとの見込みでした。まだ、抜け道があれば、ご教示いただけると幸いです。

## 参考リンク

- [&lt;webview&gt; タグ](https://github.com/electron/electron/blob/master/docs-translations/jp/api/web-view-tag.md)
- [Electron の <webview> 内でリンクを開いたときに外部ブラウザで開く - Qiita](http://qiita.com/Linda_pp/items/219847322dda3973557b)
- [element.setAttribute - Web API インターフェイス | MDN](https://developer.mozilla.org/ja/docs/Web/API/Element/setAttribute)
- [element.removeAttribute - Web API インターフェイス | MDN](https://developer.mozilla.org/ja/docs/Web/API/Element/removeAttribute)
- [Electron でマークダウンからHTMLへの変換ソフトを自作してみた - Qiita](http://qiita.com/yasumichi/items/b3acec72d740fba4b7f7)
