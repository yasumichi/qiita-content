---
title: Sphinx + myst_parser で日本語タイトル行の id を URLエンコードで作成する方法
tags:
  - Sphinx
  - MyST
private: false
updated_at: '2022-09-03T01:12:02+09:00'
id: f0a57a9e80f679322b40
organization_url_name: null
slide: false
ignorePublish: false
---
Sphinx + myst_parser でマークダウンから HTML を生成する際、標準では、タイトル行の日本語部分は無視されて id が生成されてしまいます。

例えば、以下のようなマークダウンから、html を作成したとします。

```markdown
## Sphinx ドキュメントのひな形の作成

...節の内容

## Sphinx テーマの変更
```

すると標準では、最初のセクションの id が sphinx、２番目のセクションの id が id1 に設定されてしまいます。

[unicode_ids拡張(日本語版説明書) — unicode_ids 2.0.5 documentation](https://h12u.com/sphinx/unicode_ids/README_ja.html)に期待したのですが、Sphinx 1.3.1 用に書かれたものであり、説明の通りでは動作させることができませんでした。

ただ、unicode_ids のソースを読むことで対処方法が判明し、目的を達成できたのでここに記録しておきます。

conf.py に以下を追加します。

```python
from sphinx.util import docutils
from urllib.parse import quote

docutils.nodes.make_id = quote
myst_heading_anchors = 6
myst_heading_slug_func = quote
```

それから ```make html``` を実行すると以下のような日本語を含むタイトルが URL エンコードされた id を生成することができました。

```html
<section id="sphinx%20%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AE%E3%81%B2%E3%81%AA%E5%BD%A2%E3%81%AE%E4%BD%9C%E6%88%90">
(中略)
</section>
<section id="sphinx%20%E3%83%86%E3%83%BC%E3%83%9E%E3%81%AE%E5%A4%89%E6%9B%B4">

```

行儀の良い方法か分かりませんが…

## 参考リンク

- [SphinxでMarkdown拡張言語のMySTを扱う – Helve Tech Blog](https://helve-blog.com/posts/python/sphinx-myst/)
- [GitHub - executablebooks/MyST-Parser: An extended commonmark compliant parser, with bridges to docutils/sphinx](https://github.com/executablebooks/MyST-Parser)
  - [Configuration](https://myst-parser.readthedocs.io/en/latest/configuration.html)
