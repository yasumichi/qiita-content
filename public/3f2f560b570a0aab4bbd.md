---
title: GitBucket で issue に開始日・終了日・進捗率等を追加しガントチャートに表示するプラグインを作成してみた
tags:
  - Scala
  - GitBucket
  - FrappeGantt
private: false
updated_at: '2025-12-26T21:35:38+09:00'
id: 3f2f560b570a0aab4bbd
organization_url_name: null
slide: false
ignorePublish: false
---
## まだ書きかけです…

あしからず

## 概要

[GitBucket](https://gitbucket.github.io/) は、[GitHub](https://github.com/) のようにネットワーク上で [Git](https://git-scm.com/) リポジトリを共有できる Web サービスです。

- Apache-2.0 ライセンスで配布されている。
- [Scala](https://scala-lang.org/) で開発されており、Java 17 実行環境があれば、起動可能。
- お試しであれば、内臓の[H2データベースエンジン](https://www.h2database.com/html/main.html)が利用できる。
  - 実運用には、[PostgreSQL](https://www.h2database.com/html/main.html) や　[MariaDB](https://mariadb.org/) などのリレーショナルデータベースサーバーの利用を推奨
- 非常に簡単にセルフホストが可能です。

私は、[GitBucket Markdown Enhanced Plugin](https://github.com/yasumichi/gitbucket-markdown-enhanced) という GitBucket 標準のマークダウンレンダリングエンジンを置き換えるプラグインを開発中です。

GitBucket のコミュニティプラグインには、既にガントチャートを表示できる [Gantt Chart plugin](https://github.com/kasancode/gitbucket-gantt-plugin) がありますが、期間を設定できないのが、個人的に不満でした。

そこで issue に開始日・終了日・進捗率等を登録し、ガントチャートに表示するプラグイン [GitBucket Flexible Gantt Plugin](https://github.com/yasumichi/gitbucket-flexible-gantt-plugin) を作成してみました。

その開発の記録です。

## 現状の成果

現状の成果として、[0.1.0](https://github.com/yasumichi/gitbucket-flexible-gantt-plugin/releases/tag/v0.1.0) をβリリースしました。

- まだ、ユーザーへの通知が表示されるべき場面で通知が表示されなかったり、エラー処理が未実装だったりします。
- 少量のデータでしか、試験しておりません。ガントチャートに表示する issue の絞り込みもできません。

以下のように登録済みの issue を表示すると右側のサイドバーに開始日、終了日、進捗、依存 issue を設定するためのフォームが表示されます。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/36738/9db4416c-9dfb-4ff5-a2fe-de4fbcd3c379.png)

:::note info
新規作成時は表示されません。
:::

リポジトリのサイドバーにある `Flexible Gantt` というメニューをクリックすると以下のようなガントチャートが表示されます。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/36738/ca4f0edf-b46e-4284-840e-ee06d8b8bec5.png)

- ガントチャート上のタスクをクリックすると該当する issue が、別ウィンドウで開きます。
- 開始日、終了日、進捗をドラッグ＆ドロップで更新できます。

## 作成しようと思ったきっかけ

概要にも書きましたが、GitBucket のコミュニティプラグインには、既にガントチャートを表示できる [Gantt Chart plugin](https://github.com/kasancode/gitbucket-gantt-plugin) がありますが、期間を設定できないのが、個人的に不満でした。

GitBucket Markdown Enhanced Plugin を開発するための情報収集中に以下の記事を見つけました。

- [GitBucketのissueで作業量を設定できるプラグイン #JavaScript - Qiita](https://qiita.com/Takumon/items/25e19501192623165407)

この記事では、issue に作業量を設定できる項目を追加し、統計などを取れるようにしたプラグインが紹介されていました。

GitBucket Markdown Enhanced Plugin の開発がひと段落したら、この記事を参考に issue に開始日・終了日を設定し、ガントチャートに表示するプラグインを作成したいと考えていました。

## ガントチャートに使用するライブラリ

ガントチャートのライブラリに関する比較記事等を見て検討した結果、[Frappe社](https://frappe.io/)の [Frappe Gantt](https://github.com/frappe/gantt) を採用することにしました。

決め手は、以下の通りです。(他のライブラリも同様かもしれませんが…)

- ガントチャート上で日程・進捗の変更ができ、そのイベントハンドラーを書ける
- ガントチャート上のタスクをクリックした際のハンドラーを書ける
- タスクの依存関係を設定できる
- デザインが気に入った

使用に当たり、以下の記事を参考にしました。

- [タスク、プロジェクト管理の表示に便利なガントチャートライブラリまとめ | hifive開発者ブログ](https://blog.htmlhifive.com/2014/09/18/gantt-chart-library-suitable-for-task-project-management/)
- [手軽にガントチャートを作れる JavaScript ライブラリ『Frappe Gantt』の使い方](https://zenn.dev/rabee/articles/how-to-use-frappe-gantt-js)
- [frappe-ganttを使ってガントチャートを作成する方法 - utamaro’s blog](https://utamaro.hatenablog.jp/entry/2018/10/04/191822)
- [Frappe Ganttとは？シンプルで使いやすいWebガントチャートライブラリの特徴と概要 | 株式会社一創](https://www.issoh.co.jp/tech/details/4090/)

## プラグイン用のテーブルをデータベースに追加する

プラグイン用のテーブル ISSUE_PERIOD をデータベースに追加しました。

```mermaid
erDiagram
  ISSUE_PERIOD {
     varchar(100) USER_NAME
     varchar(100) REPOSITORY_NAME
     int ISSUE_ID
     datetime START_DATE
     datetime END_DATE
     int PROGRESS
     varchar(100) DEPENDENCIES
  }
```

※わざわざ [mermaid](https://mermaid.js.org/) の ER図にする必要はないかもしれませんが…

### Solidbaseというライブラリを使用

GitBucketプラグインでデータベーステーブルを追加するには、[Solidbase](https://github.com/gitbucket/solidbase) というライブラリを使用してスキーマの自動更新を実装します。これにより、プラグインのバージョンアップ時に自動的にデータベーススキーマが更新されるようになります。

Solidbase は、GitBucket の開発者であるたけぞうさんが作成したライブラリです。

- [マルチリソース、マルチテナントに対応したDBマイグレーションツール「solidbase」1.0.0をリリースしました - たけぞう瀕死ブログ](https://takezoe.hatenablog.com/entry/2016/04/17/120701)

GitBucketの起動時、Solidbaseがデータベースのバージョン (VERSIONSテーブルに格納されています) をチェックし、定義されたバージョンとの差分に基づいてスキーマー更新ファイルを実行します。これにより、プラグイン独自のテーブルが自動的に作成されます。

- [Automatic Schema Updating](https://github.com/gitbucket/gitbucket/blob/master/doc/auto_update.md)

### スキーマ更新ファイルの作成

src/main/resources/update/ ディレクトリ配下に、新しいバージョンのスキーマ更新ファイル (SQLファイルまたはXMLファイル) を配置します。

#### XMLの場合

今回は、XML による方法を採用しました。

[src\main\resources\update\gitbucket-flexible-gantt-0.1.0.xml](https://github.com/yasumichi/gitbucket-flexible-gantt-plugin/blob/f85d0e9ad061f398d500f5c6fd23e76de21d1efa/src/main/resources/update/gitbucket-flexible-gantt-0.1.0.xml)

```xml:src\main\resources\update\gitbucket-flexible-gantt-0.1.0.xml
<?xml version="1.0" encoding="UTF-8"?>
<changeSet>
    <!--================================================================================================-->
    <!-- ISSUE_PERIOD -->
    <!--================================================================================================-->
    <createTable tableName="ISSUE_PERIOD">
        <column name="USER_NAME"        type="varchar(100)" nullable="false"/>
        <column name="REPOSITORY_NAME"  type="varchar(100)" nullable="false"/>
        <column name="ISSUE_ID"         type="int"          nullable="false"/>
        <column name="START_DATE"       type="datetime"     nullable="false"/>
        <column name="END_DATE"         type="datetime"     nullable="false"/>
        <column name="PROGRESS"         type="int"          nullable="false"/>
        <column name="DEPENDENCIES"     type="varchar(100)" nullable="false"/>
    </createTable>

    <addPrimaryKey
            constraintName="IDX_ISSUE_PERIOD_PK"
            tableName="ISSUE_PERIOD"
            columnNames="USER_NAME, REPOSITORY_NAME, ISSUE_ID"/>
    <addForeignKeyConstraint
            constraintName="IDX_ISSUE_PERIOD_FK0"
            baseTableName="ISSUE_PERIOD"
            baseColumnNames="USER_NAME, REPOSITORY_NAME, ISSUE_ID"
            referencedTableName="ISSUE"
            referencedColumnNames="USER_NAME, REPOSITORY_NAME, ISSUE_ID"/>
</changeSet>
```

#### SQLの場合

SQLファイルを使用する場合、ファイル名は `${moduleId}_${version}.sql` の形式に従う必要があります。 
例えば、myplugin というモジュールIDで、バージョン 1.0.0 のスキーマ更新を行う場合、以下のファイル名となります。

作成したファイル内にテーブル作成のSQL文を記述します。

```sql:src/main/resources/update/myplugin_1.0.0.sql
CREATE TABLE MY_NEW_TABLE (
    ID INT PRIMARY KEY,
    NAME VARCHAR(255)
);
```

### バージョン定義の追加

プラグイン本体に新しいバージョン定義を追加します。

[src\main\scala\Plugin.scala](https://github.com/yasumichi/gitbucket-flexible-gantt-plugin/blob/f85d0e9ad061f398d500f5c6fd23e76de21d1efa/src/main/scala/Plugin.scala#L27)

```scala
  override val versions: List[Version] = List(
    new Version("0.1.0", new LiquibaseMigration("update/gitbucket-flexible-gantt-0.1.0.xml"))
  )
```

## プラグイン本体でデータベースに関連した処理を行う場合に出たエラー

```
could not find implicit value for parameter s: gitbucket.core.model.Profile.profile.blockingApi.Session
```

```scala
      implicit val session: Session = Database.getSession(context.request)
```

## GitBucket が同梱している Slick は 3.4.1

insertOrUpdate は、MySQL のみ対応…

## 参考リンク

- [GitBucketのissueで作業量を設定できるプラグイン #JavaScript - Qiita](https://qiita.com/Takumon/items/25e19501192623165407)
- [タスク、プロジェクト管理の表示に便利なガントチャートライブラリまとめ | hifive開発者ブログ](https://blog.htmlhifive.com/2014/09/18/gantt-chart-library-suitable-for-task-project-management/)
- [手軽にガントチャートを作れる JavaScript ライブラリ『Frappe Gantt』の使い方](https://zenn.dev/rabee/articles/how-to-use-frappe-gantt-js)
- [frappe-ganttを使ってガントチャートを作成する方法 - utamaro’s blog](https://utamaro.hatenablog.jp/entry/2018/10/04/191822)
- [Frappe Ganttとは？シンプルで使いやすいWebガントチャートライブラリの特徴と概要 | 株式会社一創](https://www.issoh.co.jp/tech/details/4090/)
- [マルチリソース、マルチテナントに対応したDBマイグレーションツール「solidbase」1.0.0をリリースしました - たけぞう瀕死ブログ](https://takezoe.hatenablog.com/entry/2016/04/17/120701)
- [Automatic Schema Updating](https://github.com/gitbucket/gitbucket/blob/master/doc/auto_update.md)
