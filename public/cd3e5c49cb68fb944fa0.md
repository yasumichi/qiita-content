---
title: Spring Security + Thymeleaf + Mithril.js で CSRF対策トークンを適用
tags:
  - spring
  - Thymeleaf
  - mith
private: false
updated_at: '2021-05-14T10:20:21+09:00'
id: cd3e5c49cb68fb944fa0
organization_url_name: null
slide: false
ignorePublish: false
---
[Spring Security + ThymeleafでAjaxリクエストにCSRF対策トークンを適用](https://tosi-tech.net/2018/07/ajax-with-csrf-token-of-spring-security/) を参考に Mithril.js の場合をメモしておく。

# トークンを meta タグへ埋め込み

ここは、上記のリンクと同様、Thymeleaf テンプレートに以下を追加する。

```html
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
```

HTML5 を使用したい場合は、`th:content` の代わりに `data-th-content` 属性を使用する。

```html
<meta name="_csrf" data-th-content="${_csrf.token}"/>
<meta name="_csrf_header" data-th-content="${_csrf.headerName}"/>
```

# リクエストヘッダにトークンをセット

[Mithril.js](https://mithril.js.org/) でリクエストを投げる例


```javascript
// リクエストヘッダの準備
var headers = {};
var token = document.querySelector("meta[name='_csrf']").getAttribute("content");
var header = document.querySelector("meta[name='_csrf_header']").getAttribute("content");
headers[header] = token;

// DELETE リクエスト
m.request({
	method: "DELETE",
	url: "/organizations/" + item.organizationId,
	withCredentials: true,
	headers: headers
}).then(function (result) {
	console.log(result);
})

```

# 参考文献

- [Spring Security + ThymeleafでAjaxリクエストにCSRF対策トークンを適用](https://tosi-tech.net/2018/07/ajax-with-csrf-token-of-spring-security/)
- [【javascript】オブジェクトにプロパティを追加する - Qiita](https://qiita.com/chihiro/items/eb8c7b2ceee5274a4a8f)
