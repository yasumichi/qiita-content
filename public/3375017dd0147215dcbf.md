---
title: gitbucket-drawio-plugin で設定にかかわらず図形クリック時に本家へ飛んでいたのを修正しました
tags:
  - JavaScript
  - Scala
  - GitBucket
  - Draw.io
private: false
updated_at: '2025-12-05T22:29:55+09:00'
id: 3375017dd0147215dcbf
organization_url_name: null
slide: false
ignorePublish: false
---
## 概要

[GitBucket](https://gitbucket.github.io/) のプラグイン [gitbucket-drawio-plugin](https://github.com/onukura/gitbucket-drawio-plugin) が長らくメンテナンスされておらず、動作していなかったのを非公式に修正しています。

今回、表示された [draw.io](https://github.com/jgraph/drawio) の図形をクリックしたところ、設定にかかわらず、本家へ飛ぶのを修正しました。

## これまでの流れ

https://zenn.dev/yasumichi/articles/04d09995388959

https://zenn.dev/yasumichi/articles/87cf2e9ab60aa5

本家と異なり、設定により、セルフホストの draw.io を利用することができます。

## 修正内容

[src\main\scala\DrawioRenderer.scala](https://github.com/yasumichi/gitbucket-drawio-plugin/blob/0da3ecc98b69b91780f5a0d6c44ddeead4f8ba13/src/main/scala/DrawioRenderer.scala)

```diff
diff --git a/src/main/scala/DrawioRenderer.scala b/src/main/scala/DrawioRenderer.scala
index d7469f6..f8d0941 100644
--- a/src/main/scala/DrawioRenderer.scala
+++ b/src/main/scala/DrawioRenderer.scala
@@ -36,6 +36,8 @@ class DrawioRenderer extends Renderer with DrawioSettingsService {
        |<link rel="stylesheet" type="text/css" href="$path/plugin-assets/drawio/drawio-renderer.css">
        |<script>
        |window.DRAWIO_BASE_URL = '$baseUrl';
+       |window.DRAWIO_LIGHTBOX_URL = '$baseUrl';
+       |window.DRAWIO_VIEWER_URL = '$baseUrl';
        |window.DRAW_MATH_URL = '$baseUrl' + 'math/es5';
        |</script>
        |<script src="$viewer"></script>
```

これまで `window.DRAWIO_BASE_URL` の設定変更で描画にセルフホストの draw.io を使用できていました。

描画されたダイアグラムをクリックした際に飛ぶリンク先は、`window.DRAWIO_LIGHTBOX_URL` を設定しないといけなかったようです。
